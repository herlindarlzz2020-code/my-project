// App.js
import React from "react";
import { BrowserRouter as Router, Routes, Route } from "react-router-dom";
import { AuthProvider } from "./context/AuthContext";   // ✅ make sure this is correct path
import HomePage from "./pages/HomePage";
import LoginPage from "./pages/LoginPage";
import RegisterPage from "./pages/RegisterPage";
import JobSeekerDashboard from "./pages/JobSeekerDashboard";
import EmployerDashboard from "./pages/EmployerDashboard";
import PrivateRoute from "./components/PrivateRoute";

function App() {
  return (
    <AuthProvider>   {/* ✅ Wrap everything here */}
      <Router>
        <Routes>
          <Route path="/" element={<HomePage />} />
          <Route path="/login" element={<LoginPage />} />
          <Route path="/register" element={<RegisterPage />} />

          <Route
            path="/jobseeker-dashboard"
            element={
              <PrivateRoute roles={["jobseeker"]}>
                <JobSeekerDashboard />
              </PrivateRoute>
            }
          />

          <Route
            path="/employer-dashboard"
            element={
              <PrivateRoute roles={["employer"]}>
                <EmployerDashboard />
              </PrivateRoute>
            }
          />
        </Routes>
      </Router>
    </AuthProvider>
  );
}

export default App;


import React, { createContext, useContext, useState } from "react";
import jwtDecode from "jwt-decode";

export const AuthContext = createContext(null);

export const useAuth = () => useContext(AuthContext);

export const AuthProvider = ({ children }) => {
  const [auth, setAuth] = useState(null);

  const login = (token) => {
    try {
      const decoded = jwtDecode(token);
      const role =
        decoded["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"] ||
        decoded["role"];
      const id =
        decoded["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"] ||
        decoded["nameid"];
      const username =
        decoded["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"] ||
        decoded["unique_name"];

      const userData = {
        token,
        role: role?.toLowerCase(),
        user: { id, username },
      };

      setAuth(userData);
      localStorage.setItem("auth", JSON.stringify(userData));
    } catch (err) {
      console.error("Invalid token", err);
    }
  };

  const logout = () => {
    setAuth(null);
    localStorage.removeItem("auth");
  };

  return (
    <AuthContext.Provider value={{ auth, setAuth, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
};

import React, { useState, useEffect, useContext } from "react";
import { Container, Form, Button, Card, Alert } from "react-bootstrap";
import api from "../api";
import { AuthContext } from "../context/AuthContext";

function JobSeekerDashboard() {
  const { user } = useContext(AuthContext); // user comes from login context
  const [profile, setProfile] = useState({
    FirstName: "",
    LastName: "",
    Phone: "",
    Qualification: "",
    Skills: "",
    IsActive: true,
  });
  const [jobSeekerId, setJobSeekerId] = useState(null);
  const [message, setMessage] = useState("");

  // Load profile if exists
  useEffect(() => {
    const fetchProfile = async () => {
      try {
        const res = await api.get(`/JobSeekers/user/${user.id}`);
        if (res.data) {
          setProfile({
            FirstName: res.data.FirstName || "",
            LastName: res.data.LastName || "",
            Phone: res.data.Phone || "",
            Qualification: res.data.Qualification || "",
            Skills: res.data.Skills || "",
            IsActive: res.data.IsActive ?? true,
          });
          setJobSeekerId(res.data.JobSeekerID);
        }
      } catch (err) {
        console.log("No profile found, will create new one.");
      }
    };
    if (user?.id) fetchProfile();
  }, [user]);

  const handleChange = (e) => {
    setProfile({ ...profile, [e.target.name]: e.target.value });
  };

  const handleSave = async (e) => {
    e.preventDefault();
    try {
      if (jobSeekerId) {
        // Update existing
        await api.put(`/JobSeekers/${jobSeekerId}`, {
          JobSeekerID: jobSeekerId,
          UserID: user.id,
          ...profile,
        });
        setMessage("Profile updated successfully!");
      } else {
        // Create new
        const res = await api.post("/JobSeekers", {
          UserID: user.id,
          ...profile,
        });
        setJobSeekerId(res.data.JobSeekerID);
        setMessage("Profile created successfully!");
      }
    } catch (err) {
      console.error(err);
      setMessage("Error saving profile.");
    }
  };

  return (
    <Container className="mt-4">
      <Card>
        <Card.Body>
          <Card.Title>Job Seeker Profile</Card.Title>
          {message && (
            <Alert variant={message.includes("Error") ? "danger" : "success"}>
              {message}
            </Alert>
          )}
          <Form onSubmit={handleSave}>
            <Form.Group className="mb-3">
              <Form.Label>First Name</Form.Label>
              <Form.Control
                type="text"
                name="FirstName"
                value={profile.FirstName}
                onChange={handleChange}
                required
              />
            </Form.Group>
            <Form.Group className="mb-3">
              <Form.Label>Last Name</Form.Label>
              <Form.Control
                type="text"
                name="LastName"
                value={profile.LastName}
                onChange={handleChange}
              />
            </Form.Group>
            <Form.Group className="mb-3">
              <Form.Label>Phone</Form.Label>
              <Form.Control
                type="text"
                name="Phone"
                value={profile.Phone}
                onChange={handleChange}
              />
            </Form.Group>
            <Form.Group className="mb-3">
              <Form.Label>Qualification</Form.Label>
              <Form.Control
                type="text"
                name="Qualification"
                value={profile.Qualification}
                onChange={handleChange}
              />
            </Form.Group>
            <Form.Group className="mb-3">
              <Form.Label>Skills</Form.Label>
              <Form.Control
                type="text"
                name="Skills"
                value={profile.Skills}
                onChange={handleChange}
              />
            </Form.Group>
            <Form.Group className="mb-3">
              <Form.Check
                type="checkbox"
                label="Active"
                name="IsActive"
                checked={profile.IsActive}
                onChange={(e) =>
                  setProfile({ ...profile, IsActive: e.target.checked })
                }
              />
            </Form.Group>
            <Button type="submit" variant="primary">
              Save Profile
            </Button>
          </Form>
        </Card.Body>
      </Card>
    </Container>
  );
}

export default JobSeekerDashboard;
